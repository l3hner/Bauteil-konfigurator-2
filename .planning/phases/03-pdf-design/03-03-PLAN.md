---
phase: 03-pdf-design
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/services/pdf/pages/executiveSummary.js
autonomous: true

must_haves:
  truths:
    - "Ein Executive Summary One-Pager zeigt alle Key Facts der Konfiguration auf einer Seite"
    - "Haustyp, Wandsystem, KfW-Standard, Heizung, Lueftung, Dach, Dachform, Fenster, Treppe sind alle enthalten"
    - "Die Bauherr-Daten (Name, Personenzahl, Grundstueck) erscheinen im Summary"
    - "Das Layout ist scannbar â€” strukturiertes Grid, nicht eine lange Texttabelle"
    - "Optionale Komponenten (Lueftung, Treppe) erscheinen korrekt auch wenn 'keine' gewaehlt wurde"
  artifacts:
    - path: "src/services/pdf/pages/executiveSummary.js"
      provides: "Structured grid one-pager with all 9 component categories and Bauherr data"
      contains: "roundedRect"
  key_links:
    - from: "src/services/pdf/pages/executiveSummary.js"
      to: "ctx.catalogService"
      via: "getVariantById for all 9 categories"
      pattern: "catalogService\\.getVariantById"
    - from: "src/services/pdf/pages/executiveSummary.js"
      to: "src/services/pdf/layout.js"
      via: "layout.colors, layout.typography for consistent branding"
      pattern: "layout\\.colors"
---

<objective>
Redesign the Executive Summary page from a simple text table into a visually structured grid one-pager showing all key configuration facts at a glance.

Purpose: The executive summary is the single page that sales staff and customers reference most. It must show the complete configuration (all 9 component categories + Bauherr data + KfW standard) in a scannable, visually appealing grid layout. The current implementation uses plain text rows that are hard to scan quickly.

Output: Rewritten executiveSummary.js with structured card grid layout, all 9 categories, and Bauherr overview section.
</objective>

<execution_context>
@C:/Users/LehnerJ.LEHNER-HAUS/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/LehnerJ.LEHNER-HAUS/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-pdf-design/03-RESEARCH.md
@.planning/phases/03-pdf-design/03-01-SUMMARY.md
@src/services/pdf/layout.js
@src/services/pdf/pages/executiveSummary.js
@data/catalog.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign executiveSummary.js as a structured grid one-pager</name>
  <files>src/services/pdf/pages/executiveSummary.js</files>
  <action>
  Completely rewrite `src/services/pdf/pages/executiveSummary.js`. Keep `title: 'Ihre Konfiguration auf einen Blick'`, `condition: () => true`, but redesign the render function.

  **New layout structure:**

  ```
  +-----------------------------------------------+
  | [Header: "Ihre Konfiguration auf einen Blick"] |  (drawn by orchestrator)
  +-----------------------------------------------+
  |                                                |
  | BAUHERR SECTION (full width card)              |
  | +-------------------------------------------+  |
  | | Familie Mustermann                        |  |
  | | 4 Personen | KfW 40 | Grundst.: vorhanden|  |
  | +-------------------------------------------+  |
  |                                                |
  | COMPONENTS GRID (3x3)                          |
  | +----------+----------+----------+             |
  | | Haustyp  | Aussen-  | Innen-   |             |
  | | Stadt-   | wand     | wand     |             |
  | | villa    | CLIMATIV | ferma-   |             |
  | |          | PLUS     | cell     |             |
  | +----------+----------+----------+             |
  | | Fenster  | Dachein- | Dachform |             |
  | | Holz-Alu | deckung  | Sattel-  |             |
  | |          | Ton-     | dach     |             |
  | |          | ziegel   |          |             |
  | +----------+----------+----------+             |
  | | Heizung  | Lueftung | Treppe   |             |
  | | Vaillant | Zentral  | Holz-    |             |
  | | aroTHERM |          | wangen   |             |
  | +----------+----------+----------+             |
  |                                                |
  | TECHNICAL HIGHLIGHTS (optional row)            |
  | U-Wert Wand: 0.15 | U-Wert Fenster: 0.7 | ...|
  +-----------------------------------------------+
  ```

  **Implementation details:**

  1. **Bauherr section (y starts at ~100):**
     - Full-width card with grayLight background and gold left-border accent (3px)
     - Name: `${submission.bauherr_vorname} ${submission.bauherr_nachname}` in 'Heading' font, size 14, primary color
     - Below the name, a row of metadata chips:
       - `${submission.personenanzahl} Personen`
       - KfW standard: `submission.kfw_standard === 'KFW55' ? 'KfW 55' : 'KfW 40'`
       - Grundstueck: `layout.getGrundstueckText(submission.grundstueck)`
       - Date: formatted German date from submission.timestamp
     - Chips rendered as inline text separated by " | " in Helvetica size 9, textMuted color
     - Card height ~55px
     - y += cardHeight + 20

  2. **Component grid (3 columns x 3 rows = 9 cells):**
     - Fetch ALL 9 categories from catalogService:
       ```
       const haustyp = catalogService.getVariantById('haustypen', submission.haustyp);
       const wall = catalogService.getVariantById('walls', submission.wall);
       const innerwall = catalogService.getVariantById('innerwalls', submission.innerwall);
       const windowData = catalogService.getVariantById('windows', submission.window);
       const tiles = catalogService.getVariantById('tiles', submission.tiles);
       const dach = catalogService.getVariantById('daecher', submission.dach);
       const heizung = catalogService.getVariantById('heizung', submission.heizung);
       const lueftung = catalogService.getVariantById('lueftung', submission.lueftung);
       const treppe = catalogService.getVariantById('treppen', submission.treppe);
       ```
     - Build keyFacts array (ALWAYS 9 entries, in this exact order for the 3x3 grid):
       ```
       [
         { label: 'Haustyp', value: haustyp?.name || '-' },
         { label: 'Aussenwand', value: wall?.name || '-' },
         { label: 'Innenwand', value: innerwall?.name || '-' },
         { label: 'Fenster', value: windowData?.name || '-' },
         { label: 'Dacheindeckung', value: tiles?.name || '-' },
         { label: 'Dachform', value: dach?.name || '-' },
         { label: 'Heizung', value: heizung?.name || '-' },
         { label: 'Lueftung', value: lueftung?.name || 'Keine' },
         { label: 'Treppe', value: treppe?.name || 'Keine' }
       ]
       ```
     - Grid dimensions:
       - 3 columns, gap = 12px between cells
       - cellWidth = Math.floor((contentWidth - 2 * 12) / 3) (~approx 157px)
       - cellHeight = 70px
       - marginLeft = layout.layout.marginLeft (60)
     - For each cell:
       - `doc.roundedRect(cx, cy, cellWidth, cellHeight, 4).fill(layout.colors.grayLight);`
       - Gold left accent bar: `doc.rect(cx, cy, 3, cellHeight).fill(layout.colors.gold);`
       - Label in Helvetica size 7, textMuted color, at (cx + 12, cy + 10)
       - Value in 'Helvetica-Bold' size 9, primary color, at (cx + 12, cy + 26), with width = cellWidth - 20 to handle word wrap for long names
     - Row gap = 10px
     - y += 3 * (cellHeight + 10) + 15

  3. **Technical highlights row (if y < 700 and we have U-values):**
     - A single full-width bar with key technical specs
     - Background: light box (grayLight rounded rect)
     - Show available U-values and key specs inline:
       - Wall U-value: `wall?.technicalDetails?.uValue`
       - Window U-value: `windowData?.technicalDetails?.ugValue`
       - Heating JAZ: `heizung?.technicalDetails?.jaz`
       - Heat recovery: `lueftung?.technicalDetails?.heatRecovery`
     - Only show specs that have values (filter nulls)
     - Format as: "U-Wert Wand: 0.15 W/m2K | U-Wert Fenster: 0.7 W/m2K | ..."
     - Text in Helvetica size 8, gold for values, textMuted for labels
     - This section is OPTIONAL -- only render if there are technical values to show and space remains

  **Key differences from current implementation:**
  - 3x3 card grid instead of plain text rows
  - ALL 9 categories always present (current version conditionally excludes Treppe and Lueftung)
  - Gold accent bars on each card for visual consistency with the rest of the document
  - 'Heading' font for the Bauherr name
  - No alternating row background hack (current version uses indexOf which doesn't work correctly with arrays)
  - Technical highlights as a separate scannable row instead of inline with component names

  **Edge cases:**
  - Missing components show '-' or 'Keine' (never null/undefined in display)
  - Long component names (e.g., "Vaillant aroTHERM plus Luft/Wasser-Waermepumpe") must wrap within the cell width -- use the width parameter on doc.text()
  - If submission has no lueftung or treppe, show 'Keine' in those cells (not blank)
  </action>
  <verify>
  - `node -e "require('./src/services/pdf/pages/executiveSummary.js')"` -- no errors
  - Start the server, submit a configuration with all options selected, open the PDF
  - The executive summary page should show:
    - Bauherr name card at top with metadata
    - 3x3 grid of component cards with labels and values
    - Optional technical highlights row at bottom
  - Submit a configuration with Lueftung = 'keine' and Treppe = 'keine' -- verify those cells show 'Keine'
  - Verify all 9 categories are present on the page (Haustyp, Aussenwand, Innenwand, Fenster, Dacheindeckung, Dachform, Heizung, Lueftung, Treppe)
  - Verify no content overflows the page
  </verify>
  <done>
  The executive summary is a structured one-pager with a Bauherr data card, a 3x3 component grid showing all 9 categories with gold accent bars, and optional technical highlights. All key facts are scannable at a glance. The page renders correctly for all component combinations including 'keine' selections.
  </done>
</task>

</tasks>

<verification>
1. `node -e "require('./src/services/pdf/pages/executiveSummary.js')"` -- no errors
2. Generate a PDF with a full configuration (all components selected)
3. Verify the executive summary page contains ALL 9 categories in a structured grid
4. Generate a PDF with minimal configuration (Lueftung=keine, Treppe=keine) -- verify correct display
5. Verify the Bauherr data section shows name, person count, KfW standard, and Grundstueck status
6. Verify the page fits on a single page without overflow
</verification>

<success_criteria>
- The executive summary shows all 9 component categories (Haustyp, Aussenwand, Innenwand, Fenster, Dacheindeckung, Dachform, Heizung, Lueftung, Treppe) in a structured 3x3 grid
- Bauherr data (name, persons, KfW, Grundstueck) is prominently displayed at the top
- Each grid cell has a gold accent bar and clear label/value hierarchy
- Optional components (Lueftung, Treppe) show 'Keine' when not selected
- Technical highlights (U-values, JAZ) appear if available
- Everything fits on one page
</success_criteria>

<output>
After completion, create `.planning/phases/03-pdf-design/03-03-SUMMARY.md`
</output>
