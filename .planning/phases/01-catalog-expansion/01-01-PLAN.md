---
phase: 01-catalog-expansion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - data/catalog.json
  - src/services/catalogService.js
  - scripts/generate-placeholder-images.js
autonomous: true

must_haves:
  truths:
    - "catalogService.getDaecher() returns an array of 4 roof form options (Satteldach, Walmdach, Pultdach, Flachdach)"
    - "catalogService.getTreppen() returns an array of 4+ stair options including 'keine' for bungalows"
    - "catalogService.validateSelection() rejects invalid dach/treppe IDs with German error messages"
    - "catalogService.getVariantById('daecher', 'satteldach') returns a valid catalog entry"
    - "catalogService.getVariantById('treppen', 'holzwangentreppe') returns a valid catalog entry"
    - "Catalog load failure fallback includes daecher:[] and treppen:[]"
  artifacts:
    - path: "data/catalog.json"
      provides: "daecher and treppen arrays with full catalog entries"
      contains: "daecher"
    - path: "src/services/catalogService.js"
      provides: "getDaecher(), getTreppen(), validation rules, fallback keys"
      exports: ["getDaecher", "getTreppen"]
    - path: "assets/variants/daecher/"
      provides: "Placeholder images for 4 roof forms"
    - path: "assets/variants/treppen/"
      provides: "Placeholder images for stair options"
  key_links:
    - from: "src/services/catalogService.js"
      to: "data/catalog.json"
      via: "loadCatalog reads daecher/treppen arrays"
      pattern: "this\\.catalog\\.daecher"
---

<objective>
Add complete catalog data for two new categories (Daecher and Treppen) to catalog.json and extend catalogService.js with getter methods, whitelist validation, and fallback keys.

Purpose: Establish the data foundation that all downstream integration (routes, form, PDF) depends on. Without catalog entries, no other component can function.
Output: catalog.json with daecher/treppen arrays, catalogService with getDaecher/getTreppen/validation, placeholder images generated.
</objective>

<execution_context>
@C:/Users/LehnerJ.LEHNER-HAUS/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/LehnerJ.LEHNER-HAUS/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-catalog-expansion/01-RESEARCH.md

@data/catalog.json
@src/services/catalogService.js
@scripts/generate-placeholder-images.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add daecher and treppen catalog entries to catalog.json</name>
  <files>data/catalog.json</files>
  <action>
Add two new top-level arrays to data/catalog.json: "daecher" and "treppen".

**daecher array** (4 entries) — each entry follows the established catalog schema with these fields: id, name, description, premiumFeatures[], advantages[], comparisonNotes, filePath, technicalDrawing. All text in German.

Entries:
1. id: "satteldach", name: "Satteldach"
   - description: Classic gabled roof with two sloped surfaces meeting at a ridge. Most popular roof form in Germany.
   - advantages: Optimal attic space utilization, proven durable construction, ideal for PV, wide design freedom (dormers, bays)
   - filePath: "assets/variants/daecher/satteldach.png", technicalDrawing: "assets/variants/daecher/satteldach-technical.png"

2. id: "walmdach", name: "Walmdach"
   - description: Hip roof with four sloped surfaces. Elegant appearance, excellent wind resistance.
   - advantages: Superior wind resistance, elegant look, strong structural integrity, weather protection on all sides
   - filePath: "assets/variants/daecher/walmdach.png", technicalDrawing: "assets/variants/daecher/walmdach-technical.png"

3. id: "pultdach", name: "Pultdach"
   - description: Single-slope roof. Modern architecture, maximum wall area for windows/light.
   - advantages: Modern design, optimal natural light, ideal PV orientation, cost-efficient construction
   - filePath: "assets/variants/daecher/pultdach.png", technicalDrawing: "assets/variants/daecher/pultdach-technical.png"

4. id: "flachdach", name: "Flachdach"
   - description: Flat or nearly flat roof. Bauhaus aesthetics, rooftop terrace potential.
   - advantages: Additional usable area (roof terrace), modern aesthetic, easy PV installation, flexible floor plan
   - filePath: "assets/variants/daecher/flachdach.png", technicalDrawing: "assets/variants/daecher/flachdach-technical.png"

All entries: kfwCompatible: ["KFW55", "KFW40"] (roof form is KfW-neutral per research).

**treppen array** (5 entries):
1. id: "keine", name: "Keine Treppe"
   - description: For single-story buildings (Bungalow) without staircase requirement.
   - advantages: Barrierefreies Wohnen, more usable ground floor area, cost saving
   - filePath: null, technicalDrawing: null

2. id: "holzwangentreppe", name: "Holzwangentreppe"
   - description: Classic wooden stringer staircase. Warm natural material, customizable.
   - advantages: Warm wood aesthetic, many wood/finish options, proven construction, good value
   - filePath: "assets/variants/treppen/holzwangentreppe.png", technicalDrawing: "assets/variants/treppen/holzwangentreppe-technical.png"

3. id: "betontreppe", name: "Betontreppe"
   - description: Solid reinforced concrete staircase. Maximum stability and sound insulation.
   - advantages: Best sound insulation, fireproof, unlimited surface finishes, longest service life
   - filePath: "assets/variants/treppen/betontreppe.png", technicalDrawing: "assets/variants/treppen/betontreppe-technical.png"

4. id: "stahlholztreppe", name: "Stahl-Holz-Treppe"
   - description: Steel-wood combination staircase. Open, airy design with industrial charm.
   - advantages: Light and airy look, slim design, combination of materials, modern aesthetic
   - filePath: "assets/variants/treppen/stahlholztreppe.png", technicalDrawing: "assets/variants/treppen/stahlholztreppe-technical.png"

5. id: "aussentreppe", name: "Außentreppe"
   - description: External staircase for separate upper-floor access or garden connection.
   - advantages: Separate access to upper floors, garden connection, additional emergency exit
   - filePath: "assets/variants/treppen/aussentreppe.png", technicalDrawing: "assets/variants/treppen/aussentreppe-technical.png"

All treppen entries except "keine": kfwCompatible: ["KFW55", "KFW40"]. The "keine" entry: kfwCompatible: ["KFW55", "KFW40"] as well (it's a valid choice for any standard).

Add comparisonNotes to each entry with sales-oriented comparison tips in German (2-3 sentences). Use the same style as existing comparisonNotes in the catalog.

Write ALL German text with proper Umlauts (ä, ö, ü, ß) — NOT ae, oe, ue substitutions.
  </action>
  <verify>
Run: `node -e "const c = require('./data/catalog.json'); console.log('daecher:', c.daecher.length, 'treppen:', c.treppen.length); c.daecher.forEach(d => console.log(' -', d.id, d.name)); c.treppen.forEach(t => console.log(' -', t.id, t.name));"` from project root.
Expected: daecher: 4, treppen: 5, all IDs and names listed.
  </verify>
  <done>catalog.json contains 4 daecher entries and 5 treppen entries with complete German descriptions, advantages, comparisonNotes, filePaths, and kfwCompatible arrays.</done>
</task>

<task type="auto">
  <name>Task 2: Extend catalogService with new getters, validation, and fallback</name>
  <files>src/services/catalogService.js, scripts/generate-placeholder-images.js</files>
  <action>
**catalogService.js changes:**

1. Add getter methods (follow existing pattern like getDecken):
   ```javascript
   getDaecher() {
     return this.catalog.daecher || [];
   }

   getTreppen() {
     return this.catalog.treppen || [];
   }
   ```
   Place them after getDecken() and before getWindows() to maintain alphabetical-ish grouping by building component.

2. Add to loadCatalog() fallback object (line ~16-25): Add `daecher: []` and `treppen: []` to the return object in the catch block. This prevents crashes if catalog.json fails to load.

3. Add validation rules in validateSelection() method. Add AFTER the existing lueftung validation block (before the return statement):
   ```javascript
   // Validate dach selection
   if (selection.dach && !this.getVariantById('daecher', selection.dach)) {
     errors.push('Ungültige Dachauswahl');
   }

   // Validate treppe selection
   if (selection.treppe && !this.getVariantById('treppen', selection.treppe)) {
     errors.push('Ungültige Treppenauswahl');
   }
   ```

   Note: Both use the `if (selection.field && !...)` pattern — null/undefined selections are allowed (backward compatibility with old submissions and optional fields like Treppen for bungalows).

**generate-placeholder-images.js changes:**

Add color entries to the COLORS object for the two new categories:
```javascript
daecher: { r: 102, g: 51, b: 0 },
treppen: { r: 153, g: 51, b: 102 }
```

Then run the script to generate placeholder images: `node scripts/generate-placeholder-images.js`

This will auto-generate placeholder PNGs for all filePath/technicalDrawing entries in the new catalog categories.
  </action>
  <verify>
Run these commands from project root:
1. `node -e "const cs = require('./src/services/catalogService'); console.log('getDaecher:', cs.getDaecher().length); console.log('getTreppen:', cs.getTreppen().length); console.log('getVariantById daecher satteldach:', cs.getVariantById('daecher', 'satteldach')?.name); console.log('getVariantById treppen holzwangentreppe:', cs.getVariantById('treppen', 'holzwangentreppe')?.name);"`
   Expected: getDaecher: 4, getTreppen: 5, names printed.

2. `node -e "const cs = require('./src/services/catalogService'); const r1 = cs.validateSelection({dach: 'invalid-id'}); const r2 = cs.validateSelection({dach: 'satteldach'}); const r3 = cs.validateSelection({treppe: 'bogus'}); console.log('invalid dach:', r1); console.log('valid dach:', r2); console.log('invalid treppe:', r3);"`
   Expected: invalid dach has error, valid dach has no error, invalid treppe has error.

3. Verify placeholder images exist: `ls assets/variants/daecher/ assets/variants/treppen/`
  </verify>
  <done>catalogService has getDaecher() and getTreppen() returning catalog arrays, validateSelection rejects invalid dach/treppe IDs with German errors 'Ungültige Dachauswahl' and 'Ungültige Treppenauswahl', loadCatalog fallback includes daecher:[] and treppen:[], and placeholder images exist in assets/variants/daecher/ and assets/variants/treppen/.</done>
</task>

</tasks>

<verification>
1. `node -e "const cs = require('./src/services/catalogService'); console.log(cs.getDaecher().map(d=>d.id)); console.log(cs.getTreppen().map(t=>t.id));"` shows all expected IDs
2. `node -e "const cs = require('./src/services/catalogService'); console.log(cs.validateSelection({dach:'fake'}).errors);"` returns `['Ungültige Dachauswahl']`
3. `node -e "const cs = require('./src/services/catalogService'); console.log(cs.validateSelection({treppe:'fake'}).errors);"` returns `['Ungültige Treppenauswahl']`
4. `node -e "const cs = require('./src/services/catalogService'); console.log(cs.validateSelection({dach:null, treppe:null}).valid);"` returns `true` (null is allowed for backward compat)
5. Placeholder images exist: `ls assets/variants/daecher/*.png assets/variants/treppen/*.png`
</verification>

<success_criteria>
- catalog.json has daecher (4 entries) and treppen (5 entries) with complete German content
- catalogService.getDaecher() and getTreppen() work correctly
- catalogService.validateSelection() validates dach/treppe with German error messages
- loadCatalog fallback includes daecher:[] and treppen:[]
- Placeholder images generated for all filePath entries
</success_criteria>

<output>
After completion, create `.planning/phases/01-catalog-expansion/01-01-SUMMARY.md`
</output>
